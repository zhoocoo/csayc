---
title: vue3ç¼–å†™ä¸€ä¸ªv-modelçš„hooks
description: ç®€å•ä»‹ç»vue3çš„setupè¯­æ³•å¦‚ä½•è‡ªå®šä¹‰v-modelï¼Œä»¥åŠå¦‚ä½•æå–å…¬ç”¨é€»è¾‘ï¼Œå°è£…ä¸€ä¸ªhooks;
categories:
  - é‡å­¦Vue3
image:
  src: '/img/article/head/vModel.png'
  alt: 'vue3ç¼–å†™ä¸€ä¸ªv-modelçš„hooks'
  width: 400
  height: 300
tags:
  - Vue3
  - composables
  - v-model
---

## ğŸ‹ å‰è¨€

- åŸºç¡€ç¯‡ï¼šç®€å•ä»‹ç»`vue3`çš„`setup`è¯­æ³•å¦‚ä½•è‡ªå®šä¹‰`v-model`ï¼›
- è¿›é˜¶ç¯‡ï¼šå¦‚ä½•æå–`v-model`è¯­æ³•ä½œä¸ºä¸€ä¸ªå…¬ç”¨`hooks`ï¼›

## ğŸŠ åŸºç¡€

åŸºç¡€ç¯‡å¯ç»•è¿‡ï¼Œåªæ˜¯å¯¹äºå®˜ç½‘ç»™å‡ºçš„æ•™ç¨‹ï¼Œè¿›è¡Œäº†æ€»ç»“æ¦‚æ‹¬å¹¶ç»™å‡º`demo`

### åŸºæœ¬çš„ v-model

å­ç»„ä»¶ä¸­æ»¡è¶³ä¸¤ä¸ªç‚¹ï¼Œå³å¯å®Œæˆè‡ªå®šä¹‰åŒå‘ç»‘å®šï¼š

- `props`ä¸­å®šä¹‰ä¸€ä¸ªå€¼`xxx`
- `emit`ä¸­å®šä¹‰ä¸€ä¸ª`update:xxx`äº‹ä»¶

ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæœ€åŸºæœ¬çš„`v-model`ç»„ä»¶ï¼š

1. `props`ä¸­å®šä¹‰ä¸€ä¸ª`modelValue`å€¼ï¼Œå¹¶ç»‘å®šåˆ°`input`çš„`value`å±æ€§ä¸Šï¼›
2. `emit`ä¸­å®šä¹‰ä¸€ä¸ª`update:modelValue`äº‹ä»¶

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“`modelValue`ä½œä¸º`props`ä¼ å…¥ï¼Œ`update:modelValue`äº‹ä»¶å°†è¢«è‡ªåŠ¨æ³¨å†Œåˆ°`emit`äº‹ä»¶ä¸­

```html
<template>
  <input
    type="text"
    @input="emit('update:modelValue', $event.target.value)"
    :value="props.modelValue"
  />
</template>

<script setup>
  const emit = defineEmits()
  const props = defineProps({
    modelValue: String
  })
</script>
```

çˆ¶ç»„ä»¶ä¸­ï¼Œå¼•å…¥`modelComp`å­ç»„ä»¶ï¼Œå¹¶ç»‘å®š`test`å€¼åˆ°`v-model`ä¸Šï¼Œtest ä¾¿å®Œæˆäº†ä¸€æ¬¡åŒå‘ç»‘å®šã€‚

```html
<template>
  <modelComp v-model="test"></modelComp>
</template>

<script setup>
  import { ref, watch } from 'vue'
  import modelComp from './components/model/modelComp.vue'
  const test = ref('')
</script>
```

è¿™ä¾¿æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è‡ªå®šä¹‰`v-model`ç»„ä»¶ï¼›

### å¤šä¸ª v-model ç»‘å®š

å½“æˆ‘ä»¬éœ€è¦å¤šä¸ªåŒå‘ç»‘å®šæ—¶ï¼Œå¦‚ä¸‹ï¼š

```html
<modelComp
  v-model="test"
  v-model:test1="test1"
  v-model:test2="test2"
></modelComp>

<script setup>
  import { ref, watch } from 'vue'
  import modelComp from './components/model/modelComp.vue'
  const test = ref('')
  const test1 = ref('')
  const test2 = ref('')
</script>
```

å­ç»„ä»¶ä¸­ï¼ŒåŒæ ·æŒ‰ç€ä¸¤ä¸ªç‚¹æ¥å®šä¹‰ï¼š

1. `props`ä¸­å®šä¹‰ä¸¤ä¸ªå€¼ï¼Œ`test1`å’Œ`test2`
2. `emits`ä¸­å®šä¹‰ä¸¤ä¸ªäº‹ä»¶ï¼Œ`update:test1`å’Œ`update:test2`

```html
<template>
  <input
    type="text"
    @input="emit('update:modelValue', $event.target.value)"
    :value="props.modelValue"
  />
  <input
    type="text"
    @input="emit('update:test1', $event.target.value)"
    :value="props.test1"
  />
  <input
    type="text"
    @input="emit('update:test2', $event.target.value)"
    :value="props.test2"
  />
</template>

<script setup>
  const emit = defineEmits([
    'update:modelValue',
    'update:test1',
    'update:test2'
  ])
  const props = defineProps({
    modelValue: String,
    test1: String,
    test2: String
  })
</script>
```

### v-model ä¿®é¥°ç¬¦

`vue`æä¾›äº†ä¸€äº›`v-model`[ä¿®é¥°ç¬¦](https://v3.cn.vuejs.org/guide/forms.html#lazy)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`v-model`ä¸­ä½¿ç”¨ä»–ä»¬ï¼š

```html
<modelComp
  v-model.trim="test"
  v-model:test1.lazy="test1"
  v-model:test2.trim.lazy="test2"
></modelComp>
```

åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®šä¹‰ä¿®é¥°ç¬¦ï¼Œæ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä¸¾ä¸ªæ —å­ï¼š

```html
<modelComp v-model.a="test" v-model:test1.b.c="test1"></modelComp>
```

é»˜è®¤`v-model`ä¸­æˆ‘ä»¬ç»‘å®šäº†`a`ä¿®é¥°ç¬¦ï¼Œ`v-model:test1`ä¸­åˆ™ç»‘å®š`b`å’Œ`c`ä¸¤ä¸ªä¿®é¥°ç¬¦;

å¯¹äºä¿®é¥°ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- å¯¹äºé»˜è®¤`v-model`æ¥è¯´ï¼Œéœ€è¦`props`ä¸­å®šä¹‰ä¸¤ä¸ªå€¼
  - `modelValue`
  - `modelModifiers`ï¼Œæ¥å—ä¿®é¥°ç¬¦`key`å€¼
- å¯¹äºè‡ªå®šä¹‰`v-model:xxx`æ¥è¯´ï¼Œ`props`ä¸­ï¼š
  - `xxx`
  - `xxxModeifiers`ï¼Œæ¥å—ä¿®é¥°ç¬¦`key`å€¼

ç”±æ­¤ï¼Œä¸Šä»£ç ï¼š

```html
<template>
  <input type="text" @input="vModelInput" :value="props.modelValue" />
  <input type="text" @input="vModelTest1" :value="props.test1" />
</template>

<script setup>
  const emit = defineEmits(['update:modelValue', 'update:test1'])
  const props = defineProps({
    modelValue: String,
    //æ¥å—v-modelçš„ä¿®é¥°ç¬¦
    modelModifiers: {
      default: () => ({})
    },
    test1: String,
    //æ¥å—v-model:test1çš„ä¿®é¥°ç¬¦
    test1Modifiers: {
      default: () => ({})
    }
  })

  const vModelInput = (e) => {
    let value = e.target.value
    console.log(props.modelModifiers)
    //{a:true}
    if (props.modelModifiers.a) {
      //å¤„ç†valueå€¼
    }
    emit('update:modelValue', value)
  }

  const vModelTest1 = (e) => {
    let value = e.target.value
    console.log(props.test1Modifiers)
    //{b:true,c:true}
    if (props.modelModifiers.b) {
      //å¤„ç†valueå€¼
    }
    if (props.modelModifiers.c) {
      //å¤„ç†valueå€¼
    }
    emit('update:test1', value)
  }
</script>
```

## ğŸ‡ è¿›é˜¶

### é—®é¢˜èƒŒæ™¯

åŸºç¡€ç¯‡ä¸­å·²ç»è®²è§£äº†å¦‚ä½•å°è£…ä¸€ä¸ªè‡ªå®šä¹‰`v-model`çš„ç»„ä»¶ï¼Œå¯æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œå­ç»„ä»¶ä¸­ä½¿ç”¨`@input`å’Œ`:value`æ¥ç»‘å®šæˆ‘ä»¬çš„å€¼ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„åŠæ³•å‘¢ï¼Ÿ

æˆ‘ä»¬é€šå¸¸æƒ³è¦å¯¹éœ€è¦åŒå‘ç»‘å®šçš„å­ç»„ä»¶ï¼Œç›´æ¥è¿›è¡Œ`v-model`ç»‘å®šï¼š

```html
<!-- å­ç»„ä»¶ -->
<input type="text" v-model="xxx" />
```

é—®é¢˜æ¥äº†ï¼Œåœ¨å­ç»„ä»¶ä¸­æ¥å—åˆ°çˆ¶ç»„ä»¶çš„ä¼ å€¼æ—¶ï¼Œ`xxx`æˆ‘ä»¬åº”è¯¥ç»‘å®šè°ï¼Ÿç›´æ¥ç»‘å®š`props.modelValue`ä¹ˆï¼Ÿ

```html
<!-- å­ç»„ä»¶ -->
<input type="text" v-model="props.modelValue" />
```

æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼š

```bash
âš ï¸reactivity.esm-bundler.js:512 Set operation on key "modelValue" failed: target is readonly.
```

å› ä¸º`props`æ˜¯ä¸€ä¸ª`readonly`çš„å€¼(`isReadonly(props) === true`)ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥è¿™ä¹ˆä½¿ç”¨

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦ä¸€ä¸ªä¸­é—´å€¼æ¥ç»‘å®š`v-model`

### æ–¹å¼ä¸€ï¼šé€šè¿‡`watch`ä¸­è½¬

å€ŸåŠ©å†…éƒ¨å˜é‡ç»‘å®š`v-model`ï¼Œä½¿ç”¨`watch`ç›‘å¬å®ƒï¼Œå¹¶åŒæ­¥æ•°æ®`props.xxx`

```html
<!-- å­ç»„ä»¶ -->
<template>
  <input type="text" v-model="proxy" />
</template>

<script setup>
  import { ref, watch } from 'vue'
  const emit = defineEmits()
  const props = defineProps({
    modelValue: String
  })

  const proxy = ref(props.modelValue)

  watch(
    () => proxy.value,
    (v) => emit('update:modelValue', v)
  )
</script>
```

å› ä¸ºæœ‰æ—¶å€™æˆ‘ä»¬åŒå‘ç»‘å®šçš„å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`watch`é‡Œçš„`deep`é€‰é¡¹æ¥æ·±åº¦ç›‘å¬å¹¶åŒæ­¥`proxy`;

```js
watch(
  () => proxy.value,
  (v) => emit('update:modelValue', v),
  { deep: true }
)
```

å½“ç„¶ï¼Œ`props.modelValue`å¯èƒ½å­˜åœ¨é»˜è®¤å€¼ä¼ å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸Š`immediate`é€‰é¡¹ï¼Œä½¿å¾—ç»„ä»¶åœ¨åˆ›å»ºæ—¶ï¼Œå°±ç›´æ¥ç»™`proxy`èµ‹ä¸Šé»˜è®¤å€¼ï¼›

### æ–¹å¼äºŒï¼š`computed`çš„`get`å’Œ`set`

æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©`computed`æä¾›çš„`get`å’Œ`set`æ¥è¿›è¡Œæ•°æ®åŒæ­¥

```html
const proxy = computed({ get() { return props.modelValue; }, set(v) {
emit("update:modelValue", v); }, });
```

## ğŸ“ ç»ˆæï¼šå°è£…`v-model`çš„ hooks

æˆ‘ä»¬å…ˆæ¥æå–`watch`è¿™ç§æ–¹å¼ï¼Œå°†å…¶å°è£…ä¸ºä¸€ä¸ª`hooks`

```html
<!-- å­ç»„ä»¶ -->
<template>
  <input type="text" v-model="proxy" />
</template>

<script setup>
  import { ref, watch, computed } from 'vue'
  const emit = defineEmits()
  const props = defineProps({
    modelValue: String
  })

  const proxy = ref(props.modelValue)

  watch(
    () => proxy.value,
    (v) => emit('update:modelValue', v)
  )
</script>
```

åœ¨å­ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç”¨`v-model`åœ¨`input`ä¸Šç»‘å®šäº†ä¸€ä¸ªå†…éƒ¨å€¼`proxy`ï¼Œå¹¶ä»¥`props.modelValue`çš„å€¼åˆå§‹åŒ–`proxy`å˜é‡(`ref(props.modelValue)`)ï¼›

åœ¨`watch`ä¸­ï¼Œæˆ‘ä»¬ç›‘å¬`input`ä¸Šçš„ç»‘å®šå€¼`proxy`ï¼Œåœ¨`input`è¿›è¡Œè¾“å…¥å…¶å€¼å˜åŒ–æ—¶ï¼Œå‘å¤–åˆ†å‘`emit('update:modelValue',v)`äº‹ä»¶ï¼Œå°†æ”¹å˜çš„å€¼åŠ¨æ€ä¼ åˆ°å¤–éƒ¨ç»„ä»¶ä¸Š

### æå–å…¬ç”¨é€»è¾‘

```js
// useVmodel1.js
import { ref, watch } from 'vue'
export function useVmodel(props, emit) {
  const proxy = ref(props.modelValue)
  watch(
    () => proxy.value,
    (v) => emit('update:modelValue', v)
  )
  return proxy
}
```

ä¸€ä¸ªæœ€ç®€å•çš„`hooks`ä¾¿è¢«å°è£…å¥½äº†ï¼›

```html
<template>
  <input type="text" v-model="proxy" />
</template>

<script setup>
  import { ref, watch, computed } from 'vue'
  import { useVmodel } from './hooks/useVmodel1'
  const emit = defineEmits()
  const props = defineProps({
    modelValue: String
  })
  const proxy = useVmodel(props, emit)
</script>
```

### ç»§ç»­æŠ½ç¦»å°è£…

è€ƒè™‘åˆ°ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼Œç»§ç»­è¿›è¡ŒæŠ½ç¦»å°è£…ï¼š

- `emit`å¯ä»¥ä¸ä¼ ï¼Œæ›´ç®€æ´çš„è°ƒç”¨æ–¹å¼
- å¤šä¸ª`v-model:test1`è¿™ç§æƒ…å†µçš„äº‹ä»¶ï¼Œ`emit("update:xxxx")`ä¸­çš„`xxxx`äº‹ä»¶åéœ€è¦æå–

æˆ‘ä»¬å¯ä»¥é€šè¿‡`vue3`æä¾›çš„`getCurrentInstance`æ–¹æ³•ï¼Œè·å–å½“å‰çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œ`modelValue`å¯è¦†ç›–ï¼Œåˆ™æŠ½å–æˆå˜é‡:

```js
//useVmodel2.js
import { ref, watch, getCurrentInstance } from 'vue'
export function useVmodel(props, key = 'modelValue', emit) {
  const vm = getCurrentInstance()
  const _emit = emit || vm?.emit
  const event = `update:${key}`
  const proxy = ref(props[key])
  watch(
    () => proxy.value,
    (v) => _emit(event, v)
  )
  return proxy
}
```

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´ç®€å•çš„è°ƒç”¨æˆ‘ä»¬çš„`hooks`äº†ï¼š

```html
<!-- å­ç»„ä»¶ childModel -->
<template>
  <input type="text" v-model="modelValue" />
  <input type="text" v-model="test" />
</template>

<script setup>
  import { useVmodel } from './hooks/useVmodel2'
  const emit = defineEmits()
  const props = defineProps({
    modelValue: String,
    test: String
  })
  const modelValue = useVmodel(props)
  const test = useVmodel(props, 'test')
</script>

<!-- çˆ¶ç»„ä»¶ -->
<template>
  <Model v-model="modelValue" v-model:test="test" />
</template>

<script setup>
  import { ref, watch } from 'vue'
  import Model from './childModel.vue'

  const modelValue = ref('')
  const test = ref('')
</script>
```

### æœ€å

å°è£…`computed`è¿™ç§æ–¹å¼æœ¬æ–‡æš‚ä¸èµ˜è¿°ï¼Œå°ä¼™ä¼´ä»¬å¯è¿›è¡Œè‡ªè¡Œå°è£…æŠ½ç¦»ï¼Œæ¬¢è¿ä¸€èµ·è®¨è®º...
